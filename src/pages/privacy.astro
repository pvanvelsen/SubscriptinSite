---
import BaseLayout from '../layouts/BaseLayout.astro';
import Logo from '../components/Logo.astro';
import { readFile } from 'node:fs/promises';
import { join } from 'node:path';

// Read and parse the privacy policy markdown
const privacyMd = await readFile(join(process.cwd(), 'src/content/privacy.md'), 'utf-8');

// Simple markdown to HTML conversion for headings and paragraphs
function markdownToHtml(md: string): string {
  return md
    // H2 headers
    .replace(/^## (.+)$/gm, '<h2 id="$1">$1</h2>')
    // H3 headers
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    // Bold text
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    // Links
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')
    // Paragraphs
    .replace(/^([^<\n#*-].+)$/gm, '<p>$1</p>')
    // Line breaks
    .replace(/\n\n/g, '\n')
    // Horizontal rules
    .replace(/^---$/gm, '<hr />');
}

const privacyHtml = markdownToHtml(privacyMd);
---

<BaseLayout
  title="Privacy Policy"
  description="Subscripto Privacy Policy - Learn how we collect, use, and protect your subscription tracking data."
>
  <div class="min-h-screen">
    <!-- Header -->
    <header class="bg-[var(--color-surface)] dark:bg-[var(--color-surface-dark)] border-b border-gray-200 dark:border-gray-800 py-4 px-6">
      <div class="max-w-4xl mx-auto flex items-center justify-between">
        <a href="/" class="hover:opacity-80 transition-opacity">
          <Logo size="small" />
        </a>
        <a
          href="/"
          class="text-sm text-[var(--color-primary)] dark:text-[var(--color-primary-dark)] hover:underline"
        >
          ← Back to Home
        </a>
      </div>
    </header>

    <!-- Privacy Policy Content -->
    <main class="max-w-3xl mx-auto px-6 py-12">
      <article class="privacy-content">
        <Fragment set:html={privacyHtml} />
      </article>

      <!-- Footer -->
      <footer class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800 text-center text-sm text-[var(--color-on-background)] dark:text-[var(--color-on-background-dark)] opacity-60">
        <p>
          Questions about this policy? Email us at{' '}
          <a
            href="mailto:privacy@subscripto.io"
            class="text-[var(--color-primary)] dark:text-[var(--color-primary-dark)] hover:underline"
          >
            privacy@subscripto.io
          </a>
        </p>
        <p class="mt-4">© 2024 Subscripto. All rights reserved.</p>
      </footer>
    </main>
  </div>
</BaseLayout>

<style>
  .privacy-content {
    line-height: 1.8;
    font-size: 1rem;
  }

  .privacy-content h1 {
    font-size: 2.25rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    text-align: center;
    color: var(--color-primary);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content h1 {
      color: var(--color-primary-dark);
    }
  }

  .privacy-content h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--color-primary-container);
    color: var(--color-on-background);
    scroll-margin-top: 2rem;
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content h2 {
      color: var(--color-on-background-dark);
      border-bottom-color: var(--color-primary-container-dark);
    }
  }

  .privacy-content h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: var(--color-primary);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content h3 {
      color: var(--color-primary-dark);
    }
  }

  .privacy-content p {
    margin-bottom: 1.25rem;
    color: var(--color-on-background);
    opacity: 0.9;
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content p {
      color: var(--color-on-background-dark);
    }
  }

  .privacy-content strong {
    font-weight: 600;
    color: var(--color-on-background);
    opacity: 1;
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content strong {
      color: var(--color-on-background-dark);
    }
  }

  .privacy-content a {
    color: var(--color-primary);
    text-decoration: underline;
    transition: opacity 0.2s;
  }

  .privacy-content a:hover {
    opacity: 0.7;
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content a {
      color: var(--color-primary-dark);
    }
  }

  .privacy-content hr {
    margin: 2.5rem 0;
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  @media (prefers-color-scheme: dark) {
    .privacy-content hr {
      border-top-color: rgba(255, 255, 255, 0.1);
    }
  }

  /* Add spacing between sections */
  .privacy-content > *:first-child {
    margin-top: 0;
  }

  /* Print styles */
  @media print {
    header {
      display: none;
    }

    .privacy-content {
      font-size: 11pt;
      line-height: 1.6;
    }

    .privacy-content h1 {
      font-size: 18pt;
    }

    .privacy-content h2 {
      font-size: 14pt;
      page-break-after: avoid;
    }

    .privacy-content h3 {
      font-size: 12pt;
      page-break-after: avoid;
    }
  }

  /* Mobile responsiveness */
  @media (max-width: 640px) {
    .privacy-content h1 {
      font-size: 1.75rem;
    }

    .privacy-content h2 {
      font-size: 1.25rem;
    }

    .privacy-content h3 {
      font-size: 1rem;
    }
  }
</style>
